<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced To-Do List</title>
    <style>
        :root {
            --bg-color: #fff5e6;
            --text-color: #333;
            --item-bg: #fff;
            --item-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --primary-color: #FF9800;
            /* Orange */
            --secondary-color: #E91E63;
            /* Pink */
            --danger-color: #ff4444;
            --gradient-bg: linear-gradient(135deg, #FFECB3, #F8BBD0);
            /* Orange to Pink */
        }

        .dark-mode {
            --bg-color: #121212;
            --text-color: #eee;
            --item-bg: #1e1e1e;
            --item-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --gradient-bg: linear-gradient(135deg, #424242, #303030);
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--gradient-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Center content vertically */
        }        h1 {
            text-align: center;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #FF9800, #E91E63);
            color: white;
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 10px 10px;
        }

        .container {
            max-width: 700px;
            margin: 20px auto;
            padding: 25px;
            background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }        .input-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            flex: 1;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }input,
        select,
        button {
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button {
            background: linear-gradient(135deg, #FF9800, #E91E63);
            color: white;
            cursor: pointer;
            border: none;
        }

        button:hover {
            background: linear-gradient(135deg, #E91E63, #FF5722);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }        li {
            background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        li:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

        .task-details {
            display: flex;
            flex-direction: column;
        }

        .task-timer {
            font-size: 14px;
            color: var(--primary-color);
            margin-top: 5px;
        }

        .delete-btn {
            background-color: var(--danger-color);
        }

        .delete-btn:hover {
            background-color: #cc0000;
        }

        .edit-btn {
            background-color: var(--secondary-color);
        }

        .edit-btn:hover {
            background-color: #7b1fa2;
        }

        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 6px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF9800, #E91E63);
            color: white;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .theme-toggle:hover {
            background: linear-gradient(135deg, #E91E63, #FF5722);
            transform: scale(1.1);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }        .empty-state {
            text-align: center;
            color: #aaa;
            font-style: italic;
            font-size: 16px;
        }

        .timer-controls {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .start-btn {
            background-color: var(--primary-color);
        }

        .start-btn:hover {
            background-color: #45a049;
        }

        .stop-btn {
            background-color: var(--danger-color);
        }

        .stop-btn:hover {
            background-color: #cc0000;
        }

        #taskHistory {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
            border-radius: 10px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }        #taskHistory h2 {
            font-size: 20px;
            color: #333;
            text-align: center;
        }

        .input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .scheduled-time {
            font-size: 14px;
            color: var(--secondary-color);
            margin-top: 5px;
            font-weight: bold;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF9800, #E91E63);
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s ease;
            max-width: 300px;
            opacity: 0;
            transform: translateY(20px);
        }        @media (max-width: 600px) {
            .container {
                padding: 20px;
                background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
                border: 1px solid #FFB74D;
            }

            .input-section {
                flex-direction: column;
                gap: 15px;
            }

            .input-group {
                min-width: auto;
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            input,
            select,
            button {
                width: 100%;
                font-size: 18px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            ul {
                padding: 0;
            }

            li {
                flex-direction: column;
                align-items: flex-start;
                padding: 20px;
                background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 4px;
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            h1 {
                font-size: 20px;
                padding: 15px;
                background: linear-gradient(135deg, #FF9800, #E91E63);
                color: white;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            }

            #currentDate {
                font-size: 14px;
                text-align: center;
            }

            .empty-state {
                font-size: 16px;
                color: #aaa;
            }            button {
                margin-bottom: 10px;
                border: none;
                background: linear-gradient(135deg, #FF9800, #E91E63);
                width: 100%;
            }

            button:hover {
                background: linear-gradient(135deg, #E91E63, #FF5722);
                transform: scale(1.05);
            }

            #taskHistory {
                margin-top: 20px;
                padding: 20px;
                background: linear-gradient(135deg, #FFF3E0, #FCE4EC);
                border: 1px solid #F8BBD0;
            }

            #taskHistory h2 {
                font-size: 18px;
                color: #cc0000;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: var(--item-bg);
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .modal-form label {
            font-weight: bold;
            color: var(--text-color);
        }

        .modal-form input,
        .modal-form select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .task-completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .complete-btn {
            background-color: #4CAF50;
            color: white;
        }        .complete-btn:hover {
            background-color: #45a049;
        }

        /* Install Button */
        .install-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s ease;
            display: none;
        }

        .install-btn:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        /* Data persistence indicator */
        .storage-indicator {
            position: fixed;
            top: 60px;
            right: 15px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 999;
            display: none;
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF9800">    <script>
        let deferredPrompt;
        let installButton;

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.error('Service Worker Registration Failed:', err));
        }

        // PWA Install prompt handling
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            hideInstallButton();
            showNotification('App installed successfully! Your data will be saved locally.');
        });

        function showInstallButton() {
            if (!installButton) {
                installButton = document.createElement('button');
                installButton.textContent = 'ðŸ“± Install App';
                installButton.className = 'install-btn';
                installButton.onclick = installApp;
                document.body.appendChild(installButton);
            }
            installButton.style.display = 'block';
        }

        function hideInstallButton() {
            if (installButton) {
                installButton.style.display = 'none';
            }
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback for browsers that don't support install prompt
                showNotification('To install: Use "Add to Home Screen" from your browser menu. Your data will be saved locally!');
            }
        }
    </script>
</head>

<body>
    <h1>Enhanced To-Do List</h1>
    <p id="currentDate"></p>
    <div class="container">        <div class="input-section">
            <div class="input-group">
                <label class="input-label" for="taskInput">Task</label>
                <input type="text" id="taskInput" placeholder="Enter a task">
            </div>

            <div class="input-group">
                <label class="input-label" for="categoryInput">Category</label>
                <select id="categoryInput">
                    <option value="">No Category</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="learning">Learning</option>
                    <option value="exercise">Exercise</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label" for="reminderInput">Schedule Time</label>
                <input type="datetime-local" id="reminderInput">
            </div>

            <div class="input-group">
                <label class="input-label" for="timerInput">Timer (minutes)</label>
                <input type="number" id="timerInput" placeholder="Timer in minutes (optional)" min="1">
            </div>

            <div class="button-group">
                <button onclick="addTask()">Add Task</button>
                <button onclick="addLearningSchedule()">Add Learning Schedule</button>
                <button onclick="addClassSchedule()">Add Class Schedule</button>
                <button onclick="addMoreTasksToBothSections()">Add Task to Both Sections</button>
                <button onclick="switchToLearningSchedule()">Switch to Learning Schedule</button>
                <button onclick="switchToClassSchedule()">Switch to Class Schedule</button>
                <button onclick="toggleHistory()">Show History</button>
            </div>
        </div>

        <ul id="taskList"></ul>
        <div id="taskHistory" style="margin-top: 30px; display: none;">
            <h2>Task History</h2>
            <p class="empty-state">No history available yet.</p>
        </div>
    </div>

    <button class="theme-toggle" onclick="toggleDarkMode()">ðŸŒ“</button>
    
    <!-- Storage indicator -->
    <div id="storageIndicator" class="storage-indicator">Data Saved âœ“</div>

    <!-- Task Edit Modal -->
    <div id="editTaskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2>Edit Task</h2>
            <div class="modal-form">
                <label for="editTaskText">Task Text:</label>
                <input type="text" id="editTaskText">

                <label for="editTaskCategory">Category:</label>
                <select id="editTaskCategory">
                    <option value="">No Category</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="learning">Learning</option>
                    <option value="exercise">Exercise</option>
                </select>

                <label>Timer Duration:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="editTaskTimerHours" min="0" placeholder="Hours">
                    <input type="number" id="editTaskTimerMinutes" min="0" max="59" placeholder="Minutes">
                </div>

                <label for="editTaskReminder">Reminder Time:</label>
                <input type="datetime-local" id="editTaskReminder">

                <button onclick="saveEditedTask()">Save Changes</button>
            </div>
        </div>
    </div>

    <audio id="alarmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3"></audio>

    <script>
        const taskList = document.getElementById('taskList');        const taskInput = document.getElementById('taskInput');
        const reminderInput = document.getElementById('reminderInput');
        let tasks = JSON.parse(localStorage.getItem('tasks')) || { learning: [], class: [] };
        let activeSchedule = localStorage.getItem('activeSchedule') || 'learning';
        let activeTimer = null;
        let timerIntervals = {}; // Store multiple timer intervals        // Load tasks on page load
        window.onload = () => {
            try {
                const isDarkMode = localStorage.getItem('darkMode') === 'true';
                if (isDarkMode) document.body.classList.add('dark-mode');

                addRandomHistory(); // Add random history for testing
                checkDayReset();
                updateScheduleUI();
                loadTasks();
                displayCurrentDate();
                displayTaskHistory();
                updateTaskHistory(); // Update task history on load
                checkIfInstalled(); // Check if app is installed
                
                console.log('Todo app loaded successfully');
                
                // Show data persistence message
                if (localStorage.getItem('tasks')) {
                    showNotification('Your data is safely stored locally!');
                }
            } catch (error) {
                console.error('Error loading todo app:', error);
            }
        };

        // Check if the day has changed and reset tasks
        function checkDayReset() {
            const lastSessionDate = localStorage.getItem('lastSessionDate');
            const today = new Date().toLocaleDateString();

            if (lastSessionDate !== today) {
                localStorage.setItem('lastSessionDate', today);
                tasks = { learning: [], class: [] }; // Clear tasks for the new day
                saveTasks();
                alert("A new day has started. Tasks have been reset.");
            }
        }        // Add a new task
        function addTask() {
            try {
                const text = taskInput.value.trim();
                const reminderValue = reminderInput.value;
                const category = document.getElementById('categoryInput').value;
                const timerMinutes = parseInt(document.getElementById('timerInput').value) || null;

                if (!text) {
                    alert('Please enter a task description');
                    return;
                }

                const reminder = reminderValue ? new Date(reminderValue).getTime() : null;
                const timer = timerMinutes ? timerMinutes * 60 : null; // Convert minutes to seconds

                const task = {
                    id: Date.now(),
                    text,
                    reminder,
                    category,
                    completed: false,
                    timer
                };

                tasks[activeSchedule].push(task);
                saveTasks();
                loadTasks();

                // Set up a reminder for this task
                if (reminder) {
                    scheduleTaskReminder(task);
                }

                taskInput.value = '';
                reminderInput.value = '';
                document.getElementById('categoryInput').value = '';
                document.getElementById('timerInput').value = '';
                
                showNotification('Task added successfully!');
            } catch (error) {
                console.error('Error adding task:', error);
                alert('Error adding task. Please try again.');
            }
        }// Add a learning schedule
        function addLearningSchedule() {
            tasks.learning = [
                { id: Date.now(), text: "Read a programming book", category: "learning", timer: 3600, completed: false, reminder: null },
                { id: Date.now() + 1, text: "Practice coding challenges", category: "learning", timer: 5400, completed: false, reminder: null },
                { id: Date.now() + 2, text: "Watch a tutorial video", category: "learning", timer: 7200, completed: false, reminder: null },
                { id: Date.now() + 3, text: "Work on a personal project", category: "learning", timer: 10800, completed: false, reminder: null }
            ];
            saveTasks();
            alert("Learning schedule added successfully!");
            switchToLearningSchedule();
        }        // Add a class schedule
        function addClassSchedule() {
            tasks.class = [
                { id: Date.now(), text: "Morning classes", category: "work", timer: null, completed: false, reminder: null },
                { id: Date.now() + 1, text: "Lunch break", category: "personal", timer: null, completed: false, reminder: null },
                { id: Date.now() + 2, text: "Afternoon classes", category: "work", timer: null, completed: false, reminder: null }
            ];
            saveTasks();
            alert("Class schedule added successfully!");
            switchToClassSchedule();
        }

        // Switch to learning schedule
        function switchToLearningSchedule() {
            activeSchedule = 'learning';
            localStorage.setItem('activeSchedule', activeSchedule);
            updateScheduleUI();
            loadTasks();
        }

        // Switch to class schedule
        function switchToClassSchedule() {
            activeSchedule = 'class';
            localStorage.setItem('activeSchedule', activeSchedule);
            updateScheduleUI();            loadTasks();
        }

        // Update the UI to reflect the active schedule
        function updateScheduleUI() {
            const learningButton = document.querySelector('button[onclick="switchToLearningSchedule()"]');
            const classButton = document.querySelector('button[onclick="switchToClassSchedule()"]');
            
            // Reset all buttons to default style first
            if (learningButton) {
                learningButton.style.backgroundColor = '';
                learningButton.style.background = '';
            }
            if (classButton) {
                classButton.style.backgroundColor = '';
                classButton.style.background = '';
            }
            
            // Highlight the active button
            if (activeSchedule === 'learning' && learningButton) {
                learningButton.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                learningButton.style.color = 'white';
            } else if (activeSchedule === 'class' && classButton) {
                classButton.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                classButton.style.color = 'white';
            }
        }

        // Load and display tasks
        function loadTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            if (!tasks[activeSchedule] || tasks[activeSchedule].length === 0) {
                taskList.innerHTML = '<p class="empty-state">No tasks yet. Add a task to get started!</p>';                return;
            }

            tasks[activeSchedule].forEach(task => {
                const li = document.createElement('li');
                li.className = task.completed ? 'task-completed' : '';
                li.innerHTML = `
                    <div class="task-details">
                        <span>${task.text} (${task.category || "No Category"})</span>
                        ${task.timer !== null && task.timer !== undefined ? `<span class="task-timer" id="timer-${task.id}">Timer: ${formatTime(task.timer)}</span>` : ''}
                        ${task.reminder ? `<span class="scheduled-time">Scheduled: ${new Date(task.reminder).toLocaleString()}</span>` : ''}
                    </div>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="complete-btn" onclick="toggleTaskCompletion(${task.id})">${task.completed ? 'Undo' : 'Complete'}</button>
                        ${task.timer !== null && task.timer !== undefined ? `
                        <div class="timer-controls">
                            <button class="start-btn" onclick="startTimer(${task.id})">Start</button>
                            <button class="stop-btn" onclick="stopTimer(${task.id})">Stop</button>
                        </div>` : ''}
                        <button class="edit-btn" onclick="editTask(${task.id})">Edit</button>
                        <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
                    </div>
                `;
                taskList.appendChild(li);

                // If we have a reminder, schedule it
                if (task.reminder) {
                    scheduleTaskReminder(task);
                }
            });
        }

        // Edit a task
        function editTask(id) {
            const task = tasks[activeSchedule].find(t => t.id === id);
            if (!task) return;

            const modal = document.getElementById('editTaskModal');
            document.getElementById('editTaskText').value = task.text;
            document.getElementById('editTaskCategory').value = task.category || '';
            document.getElementById('editTaskTimerHours').value = task.timer !== null ? Math.floor(task.timer / 3600) : 0;
            document.getElementById('editTaskTimerMinutes').value = task.timer !== null ? Math.floor((task.timer % 3600) / 60) : 0;
            document.getElementById('editTaskReminder').value = task.reminder ? new Date(task.reminder).toISOString().slice(0, 16) : '';            modal.dataset.taskId = id;
            modal.style.display = 'block';
        }

        // Save edited task
        function saveEditedTask() {
            const modal = document.getElementById('editTaskModal');
            const taskId = parseInt(modal.dataset.taskId);
            const task = tasks[activeSchedule].find(t => t.id === taskId);
            if (!task) return;

            task.text = document.getElementById('editTaskText').value.trim();
            task.category = document.getElementById('editTaskCategory').value;
            const hours = parseInt(document.getElementById('editTaskTimerHours').value) || 0;
            const minutes = parseInt(document.getElementById('editTaskTimerMinutes').value) || 0;
            task.timer = (hours * 3600) + (minutes * 60) || null;
            const reminderValue = document.getElementById('editTaskReminder').value;
            task.reminder = reminderValue ? new Date(reminderValue).getTime() : null;

            saveTasks();
            loadTasks();
            closeModal();
        }

        // Toggle task completion
        function toggleTaskCompletion(id) {
            const task = tasks[activeSchedule].find(t => t.id === id);
            if (!task) return;
            
            task.completed = !task.completed;
            saveTasks();
            loadTasks();
            updateTaskHistory();
        }

        // Close the modal
        function closeModal() {
            document.getElementById('editTaskModal').style.display = 'none';
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            const modal = document.getElementById('editTaskModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Delete a task
        function deleteTask(id) {
            tasks[activeSchedule] = tasks[activeSchedule].filter(t => t.id !== id);
            saveTasks();
            loadTasks();
        }        // Save tasks to localStorage
        function saveTasks() {            localStorage.setItem('tasks', JSON.stringify(tasks));
            showStorageIndicator();
        }

        // Show storage indicator
        function showStorageIndicator() {
            const indicator = document.getElementById('storageIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        // Check if app is installed
        function checkIfInstalled() {
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                console.log('App is installed');
                hideInstallButton();
                showNotification('Welcome back! Your data is saved locally.');
            }
        }

        // Format time in HH:MM:SS
        function formatTime(seconds) {
            if (seconds === null || seconds === undefined || isNaN(seconds)) {
                return "00:00:00";
            }
            
            const hrs = Math.floor(Math.abs(seconds) / 3600);
            const mins = Math.floor((Math.abs(seconds) % 3600) / 60);
            const secs = Math.abs(seconds) % 60;            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Start the timer for a task
        function startTimer(id) {
            const task = tasks[activeSchedule].find(t => t.id === id);
            if (!task || task.timer === null || task.timer === undefined) return;

            // Stop any existing timer for this task
            if (timerIntervals[id]) {
                clearInterval(timerIntervals[id]);
            }

            timerIntervals[id] = setInterval(() => {
                if (task.timer > 0) {
                    task.timer--;
                    const timerElement = document.getElementById(`timer-${id}`);
                    if (timerElement) {
                        timerElement.textContent = `Timer: ${formatTime(task.timer)}`;
                    }
                    saveTasks(); // Save the updated timer value
                } else {
                    clearInterval(timerIntervals[id]);
                    delete timerIntervals[id];
                    showNotification(`Time's up for task: ${task.text}`);
                    
                    // Play alarm sound
                    const alarmSound = document.getElementById('alarmSound');
                    if (alarmSound) {
                        alarmSound.currentTime = 0;
                        alarmSound.play().catch(e => console.log('Audio playback error:', e));
                    }
                }
            }, 1000);
        }

        // Stop the timer for a task
        function stopTimer(id) {
            if (timerIntervals[id]) {
                clearInterval(timerIntervals[id]);
                delete timerIntervals[id];
                showNotification("Timer stopped.");
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Add more tasks to both sections
        function addMoreTasksToBothSections() {
            const newTaskText = prompt("Enter the task to add to both sections:");
            if (!newTaskText || !newTaskText.trim()) return;

            const newTask = {
                id: Date.now(),
                text: newTaskText.trim(),
                category: "general",
                completed: false,
                timer: null,
                reminder: null
            };

            // Add to learning schedule
            tasks.learning.push({ ...newTask, id: Date.now() });
            
            // Add to class schedule with different ID
            tasks.class.push({ ...newTask, id: Date.now() + 1 });
            
            saveTasks();
            alert("Task added to both sections!");
            loadTasks();
        }

        // Display current day and date
        function displayCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };            dateElement.textContent = today.toLocaleDateString(undefined, options);
        }

        // Track and display task history
        function updateTaskHistory() {
            const history = JSON.parse(localStorage.getItem('taskHistory')) || {};
            const today = new Date().toLocaleDateString();

            if (!history[today]) {
                history[today] = { completed: [], missed: [] };
            }

            // Clear today's history before updating
            history[today] = { completed: [], missed: [] };

            // Update history for both schedules
            ['learning', 'class'].forEach(schedule => {
                if (tasks[schedule]) {
                    tasks[schedule].forEach(task => {
                        if (task.completed && !history[today].completed.some(t => t.id === task.id)) {
                            history[today].completed.push({
                                id: task.id,
                                text: task.text,
                                category: task.category,
                                schedule: schedule
                            });
                        } else if (!task.completed && !history[today].missed.some(t => t.id === task.id)) {
                            history[today].missed.push({
                                id: task.id,
                                text: task.text,
                                category: task.category,
                                schedule: schedule
                            });
                        }
                    });
                }
            });

            localStorage.setItem('taskHistory', JSON.stringify(history));
            displayTaskHistory();
        }

        // Display task history
        function displayTaskHistory() {
            const historySection = document.getElementById('taskHistory');
            const history = JSON.parse(localStorage.getItem('taskHistory')) || {};
            
            if (Object.keys(history).length === 0) {
                historySection.innerHTML = '<h2>Task History</h2><p class="empty-state">No history available yet.</p>';
                return;
            }

            let historyHTML = '<h2>Task History</h2>';
            
            // Sort dates in descending order (most recent first)
            const sortedDates = Object.keys(history).sort((a, b) => new Date(b) - new Date(a));
            
            sortedDates.forEach(date => {
                const record = history[date];
                historyHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--item-bg); border-radius: 8px; box-shadow: var(--item-shadow);">
                        <h3 style="color: var(--primary-color); margin-bottom: 10px;">${date}</h3>
                        <div style="margin-bottom: 10px;">
                            <strong style="color: #4CAF50;">Completed (${record.completed.length}):</strong>
                            ${record.completed.length > 0 ? 
                                '<ul style="margin: 5px 0; padding-left: 20px;">' + 
                                record.completed.map(task => `<li>${task.text} (${task.category || 'No Category'}) - ${task.schedule}</li>`).join('') + 
                                '</ul>' : 
                                '<span style="color: #aaa; font-style: italic;">None</span>'
                            }
                        </div>
                        <div>
                            <strong style="color: var(--danger-color);">Pending/Missed (${record.missed.length}):</strong>
                            ${record.missed.length > 0 ? 
                                '<ul style="margin: 5px 0; padding-left: 20px;">' + 
                                record.missed.map(task => `<li>${task.text} (${task.category || 'No Category'}) - ${task.schedule}</li>`).join('') + 
                                '</ul>' : 
                                '<span style="color: #aaa; font-style: italic;">None</span>'
                            }
                        </div>
                    </div>
                `;
            });
              historySection.innerHTML = historyHTML;
        }

        // Add random history for testing purposes
        function addRandomHistory() {
            const history = JSON.parse(localStorage.getItem('taskHistory')) || {};
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const dayBeforeYesterday = new Date(today);
            dayBeforeYesterday.setDate(today.getDate() - 2);

            if (!history[yesterday.toLocaleDateString()]) {
                history[yesterday.toLocaleDateString()] = {
                    completed: [
                        { id: 1, text: "Read programming book", category: "learning", schedule: "learning" },
                        { id: 2, text: "Morning exercise", category: "exercise", schedule: "class" }
                    ],
                    missed: [
                        { id: 3, text: "Code review", category: "work", schedule: "learning" }
                    ]
                };
            }

            if (!history[dayBeforeYesterday.toLocaleDateString()]) {
                history[dayBeforeYesterday.toLocaleDateString()] = {
                    completed: [
                        { id: 4, text: "Team meeting", category: "work", schedule: "class" }
                    ],
                    missed: [
                        { id: 5, text: "Study algorithms", category: "learning", schedule: "learning" },
                        { id: 6, text: "Grocery shopping", category: "personal", schedule: "class" }
                    ]
                };
            }

            localStorage.setItem('taskHistory', JSON.stringify(history));
        }

        // Add a function to schedule task reminders
        function scheduleTaskReminder(task) {
            if (!task.reminder) return;

            const now = new Date().getTime();
            const timeUntilReminder = task.reminder - now;

            if (timeUntilReminder > 0) {
                setTimeout(() => {
                    showNotification(`Time to start: ${task.text}`);

                    // Play alarm sound
                    const alarmSound = document.getElementById('alarmSound');
                    alarmSound.currentTime = 0; // Reset sound to the beginning
                    alarmSound.play().catch(e => console.log('Audio playback error:', e));                }, timeUntilReminder);
            }
        }

        // Function to show notifications
        function showNotification(message) {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 100);

            // Remove notification after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Toggle the visibility of the history section
        function toggleHistory() {
            const historyButton = document.querySelector('button[onclick="toggleHistory()"]');
            const historySection = document.getElementById('taskHistory');
            if (historySection.style.display === 'none') {
                historyButton.textContent = 'Hide History';
                historySection.style.display = 'block';
            } else {
                historyButton.textContent = 'Show History';
                historySection.style.display = 'none';
            }
        }

        // Check for tasks scheduled to start soon after page loads
        window.addEventListener('load', () => {
            tasks[activeSchedule].forEach(task => {
                if (task.reminder) {
                    scheduleTaskReminder(task);
                }
            });
        });
    </script>
</body>

</html>